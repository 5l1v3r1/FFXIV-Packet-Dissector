-- This file is generated by tools/json2lua.js

local db = require('ffxiv_db')
local ffxiv_ipc_item_change = Proto("ffxiv_ipc_item_change", "FFXIV-IPC ItemChange")

local function makeValString(enumTable)
  local t = {}
  for name,num in pairs(enumTable) do
      t[num] = name
  end
  return t
end

local item_quality = {
  NormalQuality = 0,
  HighQuality = 1,
}

local item_location = {
  Inventory0 = 0,
  Inventory1 = 1,
  Inventory2 = 2,
  Inventory3 = 3,
  ArmouryEquipped = 1000,
  Currency = 2000,
  Crystal = 2001,
  ArmouryOffHand = 3200,
  ArmouryHead = 3201,
  ArmouryBody = 3202,
  ArmouryHands = 3203,
  ArmouryWaist = 3204,
  ArmouryLegs = 3205,
  ArmouryFeet = 3206,
  ArmouryEars = 3207,
  ArmouryNeck = 3208,
  ArmouryWrists = 3209,
  ArmouryRightRing = 3210,
  ArmouryLeftRing = 3211,
  ArmouryRing = 3300,
  SoulCrystal = 3400,
  ArmouryMainHand = 3500,
  Saddlebag0 = 4000,
  Saddlebag1 = 4001,
}

local item_armoury_position = {
  MainHand = 0,
  OffHand = 1,
  Head = 2,
  Body = 3,
  Hands = 4,
  Waist = 5,
  Legs = 6,
  Feet = 7,
  Ears = 8,
  Neck = 9,
  Wrists = 10,
  RightRing = 11,
  LeftRing = 12,
  SoulCrystal = 13,
}

local item_quality_valstr = makeValString(item_quality)
local item_location_valstr = makeValString(item_location)
local item_armoury_position_valstr = makeValString(item_armoury_position)

local item_change_fields = {
  index      = ProtoField.uint32("ffxiv_ipc_item_change.index", "Index", base.DEC),
  unknown0   = ProtoField.uint32("ffxiv_ipc_item_change.unknown0", "Unknown0", base.DEC),
  location   = ProtoField.uint16("ffxiv_ipc_item_change.location", "Location", base.DEC, item_location_valstr),
  position   = ProtoField.uint16("ffxiv_ipc_item_change.position", "Position", base.DEC),
  amount     = ProtoField.uint32("ffxiv_ipc_item_change.amount", "Amount", base.DEC),
  item       = ProtoField.uint16("ffxiv_ipc_item_change.item", "Item", base.DEC, db.Item),
  unknown1   = ProtoField.uint16("ffxiv_ipc_item_change.unknown1", "Unknown1", base.DEC),
  unknown2   = ProtoField.uint32("ffxiv_ipc_item_change.unknown2", "Unknown2", base.DEC),
  unknown3   = ProtoField.uint32("ffxiv_ipc_item_change.unknown3", "Unknown3", base.DEC),
  unknown4   = ProtoField.uint32("ffxiv_ipc_item_change.unknown4", "Unknown4", base.DEC),
  quality    = ProtoField.uint8("ffxiv_ipc_item_change.quality", "Quality", base.DEC, item_quality_valstr),
  attribute2 = ProtoField.uint8("ffxiv_ipc_item_change.attribute2", "Attribute2", base.DEC),
  condition  = ProtoField.uint16("ffxiv_ipc_item_change.condition", "Condition", base.DEC),
  spiritbond = ProtoField.uint16("ffxiv_ipc_item_change.spiritbond", "Spiritbond", base.DEC),
  unknown5   = ProtoField.uint16("ffxiv_ipc_item_change.unknown5", "Unknown5", base.DEC),
  glamour_id = ProtoField.uint16("ffxiv_ipc_item_change.glamour_id", "GlamourID", base.DEC),
  unknown6   = ProtoField.uint32("ffxiv_ipc_item_change.unknown6", "Unknown6", base.DEC),
  unknown7   = ProtoField.uint32("ffxiv_ipc_item_change.unknown7", "Unknown7", base.DEC),
  unknown8   = ProtoField.uint32("ffxiv_ipc_item_change.unknown8", "Unknown8", base.DEC),
  unknown9   = ProtoField.uint32("ffxiv_ipc_item_change.unknown9", "Unknown9", base.DEC),
  unknown10  = ProtoField.uint32("ffxiv_ipc_item_change.unknown10", "Unknown10", base.DEC),
  unknown11  = ProtoField.uint32("ffxiv_ipc_item_change.unknown11", "Unknown11", base.DEC),
}

ffxiv_ipc_item_change.fields = item_change_fields

function ffxiv_ipc_item_change.dissector(tvbuf, pktinfo, root)
  local tree = root:add(ffxiv_ipc_item_change, tvbuf)

  -- dissect the index field
  local index_tvbr = tvbuf:range(0, 4)
  local index_val  = index_tvbr:le_uint()
  tree:add_le(item_change_fields.index, index_tvbr)

  -- dissect the unknown0 field
  local unknown0_tvbr = tvbuf:range(4, 4)
  local unknown0_val  = unknown0_tvbr:le_uint()
  tree:add_le(item_change_fields.unknown0, unknown0_tvbr)

  -- dissect the location field
  local location_tvbr = tvbuf:range(8, 2)
  local location_val  = location_tvbr:le_uint()
  tree:add_le(item_change_fields.location, location_tvbr)

  -- dissect the position field
  local position_tvbr = tvbuf:range(10, 2)
  local position_val  = position_tvbr:le_uint()
  tree:add_le(item_change_fields.position, position_tvbr)

  -- dissect the amount field
  local amount_tvbr = tvbuf:range(12, 4)
  local amount_val  = amount_tvbr:le_uint()
  tree:add_le(item_change_fields.amount, amount_tvbr)
  tree:append_text(", Amount: " .. amount_val)

  -- dissect the item field
  local item_tvbr = tvbuf:range(16, 2)
  local item_val  = item_tvbr:le_uint()
  tree:add_le(item_change_fields.item, item_tvbr)
  tree:append_text(", Item: " .. db.Item[item_val])

  -- dissect the unknown1 field
  local unknown1_tvbr = tvbuf:range(18, 2)
  local unknown1_val  = unknown1_tvbr:le_uint()
  tree:add_le(item_change_fields.unknown1, unknown1_tvbr)

  -- dissect the unknown2 field
  local unknown2_tvbr = tvbuf:range(20, 4)
  local unknown2_val  = unknown2_tvbr:le_uint()
  tree:add_le(item_change_fields.unknown2, unknown2_tvbr)

  -- dissect the unknown3 field
  local unknown3_tvbr = tvbuf:range(24, 4)
  local unknown3_val  = unknown3_tvbr:le_uint()
  tree:add_le(item_change_fields.unknown3, unknown3_tvbr)

  -- dissect the unknown4 field
  local unknown4_tvbr = tvbuf:range(28, 4)
  local unknown4_val  = unknown4_tvbr:le_uint()
  tree:add_le(item_change_fields.unknown4, unknown4_tvbr)

  -- dissect the quality field
  local quality_tvbr = tvbuf:range(32, 1)
  local quality_val  = quality_tvbr:le_uint()
  tree:add_le(item_change_fields.quality, quality_tvbr)
  tree:append_text(", Quality: " .. item_quality_valstr[quality_val])

  -- dissect the attribute2 field
  local attribute2_tvbr = tvbuf:range(33, 1)
  local attribute2_val  = attribute2_tvbr:le_uint()
  tree:add_le(item_change_fields.attribute2, attribute2_tvbr)

  -- dissect the condition field
  local condition_tvbr = tvbuf:range(34, 2)
  local condition_val  = condition_tvbr:le_uint()
  tree:add_le(item_change_fields.condition, condition_tvbr)

  -- dissect the spiritbond field
  local spiritbond_tvbr = tvbuf:range(36, 2)
  local spiritbond_val  = spiritbond_tvbr:le_uint()
  tree:add_le(item_change_fields.spiritbond, spiritbond_tvbr)

  -- dissect the unknown5 field
  local unknown5_tvbr = tvbuf:range(38, 2)
  local unknown5_val  = unknown5_tvbr:le_uint()
  tree:add_le(item_change_fields.unknown5, unknown5_tvbr)

  -- dissect the glamour_id field
  local glamour_id_tvbr = tvbuf:range(40, 2)
  local glamour_id_val  = glamour_id_tvbr:le_uint()
  tree:add_le(item_change_fields.glamour_id, glamour_id_tvbr)

  -- dissect the unknown6 field
  local unknown6_tvbr = tvbuf:range(42, 4)
  local unknown6_val  = unknown6_tvbr:le_uint()
  tree:add_le(item_change_fields.unknown6, unknown6_tvbr)

  -- dissect the unknown7 field
  local unknown7_tvbr = tvbuf:range(44, 4)
  local unknown7_val  = unknown7_tvbr:le_uint()
  tree:add_le(item_change_fields.unknown7, unknown7_tvbr)

  -- dissect the unknown8 field
  local unknown8_tvbr = tvbuf:range(48, 4)
  local unknown8_val  = unknown8_tvbr:le_uint()
  tree:add_le(item_change_fields.unknown8, unknown8_tvbr)

  -- dissect the unknown9 field
  local unknown9_tvbr = tvbuf:range(52, 4)
  local unknown9_val  = unknown9_tvbr:le_uint()
  tree:add_le(item_change_fields.unknown9, unknown9_tvbr)

  -- dissect the unknown10 field
  local unknown10_tvbr = tvbuf:range(56, 4)
  local unknown10_val  = unknown10_tvbr:le_uint()
  tree:add_le(item_change_fields.unknown10, unknown10_tvbr)

  -- dissect the unknown11 field
  local unknown11_tvbr = tvbuf:range(60, 4)
  local unknown11_val  = unknown11_tvbr:le_uint()
  tree:add_le(item_change_fields.unknown11, unknown11_tvbr)


  pktinfo.cols.info:set("ItemChange")
  return tvbuf:len()
end